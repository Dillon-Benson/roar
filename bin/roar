#! /usr/bin/env ruby
require File.dirname(__FILE__) + '/../lib/roar'
require 'ruby-growl'
require 'choice'
require 'colored'
require 'terminal-table'

Choice.options do
	option :subreddits do
		short '-s'
		long '--subreddit *SUBREDDITS'
	end

	option :interval do
		short '-i'
		long '--interval'
		default 300
	end
end

g = Growl.new "localhost", "ruby-growl"

reddits = Choice.choices[:subreddits]
count = 0
reddits.each do |reddit|
	g.add_notification(reddit)
end

notification_number = 1
adult = "No"

begin
	puts "Press ctrl-C to stop"
	loop do
		sr = Subreddit.new(reddits[count])
		g.notify(reddits[count], "/r/#{reddits[count]}", sr.title)
		if sr.over_18
			adult = "Yes"
		else
			adult = "No"
		end

		rows = [[reddits[count].white, sr.title.white, sr.url.white, sr.ups.to_s.green, sr.downs.to_s.red, sr.score.to_s.yellow, sr.over_18.to_s.red_on_blue]]
		table = Terminal::Table.new(:headings => ['subreddit', 'title', 'URL', 'Ups', 'Downs', 'Score', 'Over 18'], :rows => rows)
		puts table
		puts "\n\n\n\n"
		count = -1 if count == reddits.length - 1
		count += 1
		notification_number += 1
		sleep(Integer(Choice.choices[:interval]))
	end
	rescue Interrupt => e
		puts "#{e} Stopping..."
end